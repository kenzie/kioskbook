#!/bin/bash
# Hide cursor after 1 second of inactivity
unclutter -idle 1 &

# Disable screen blanking
xset s off
xset -dpms
xset s noblank

# Load display configuration
DISPLAY_CONFIG="/etc/kioskbook/display.conf"
if [ -f "$DISPLAY_CONFIG" ]; then
    . "$DISPLAY_CONFIG"
else
    # Fallback to default
    DISPLAY_URL="https://kioskbook.ca/display"
    DISPLAY_TOKEN="YOUR_TOKEN_HERE"
fi

# Build full URL with token
KIOSK_URL="${DISPLAY_URL}?token=${DISPLAY_TOKEN}"

# Wait a moment for network to be ready
sleep 2

# Start Chromium in kiosk mode with font optimization and hardware acceleration
exec chromium \
    --kiosk \
    --no-sandbox \
    --disable-infobars \
    --disable-features=TranslateUI \
    --enable-features=VaapiVideoDecoder,VaapiVideoEncoder \
    --disable-ipc-flooding-protection \
    --no-first-run \
    --fast \
    --fast-start \
    --disable-default-apps \
    --disable-popup-blocking \
    --disable-prompt-on-repost \
    --no-message-box \
    --start-fullscreen \
    --force-device-scale-factor=1 \
    --font-render-hinting=none \
    --disable-session-crashed-bubble \
    --disable-restore-session-state \
    --enable-gpu-rasterization \
    --ignore-gpu-blocklist \
    "$KIOSK_URL"
